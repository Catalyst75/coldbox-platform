<?xml version="1.0"?>
<project name="coldbox-tester" default="main" basedir=".">
	
	<!-- THE URL TO THE RUNNER TO USE TO PRODUCE RESULTS, THE ANTJUNIT RUNNER IS BY DEFAULT AS THIS BUILD PRODUCES JUNIT REPORTS-->
	<property name="url.runner"			value="http://cf10cboxdev.jfetmac/coldbox/ApplicationTemplates/Simple/test/runner.cfm?"/>
	<!-- FILL OUT THE BUNDLES TO TEST, CAN BE A LIST OF CFC PATHS -->
	<property name="test.bundles"		value="" />
	<!-- FILL OUT THE DIRECTORY MAPPING TO TEST -->
	<property name="test.directory"		value="test.specs" />
	<!-- Reporter output, valid reporter are: json,xml,tap,doc,codexwiki,junit,antjunit,simple,dot,min -->
	<property name="test.reporter"		value="antjunit" />
	<!-- Reporting Output Directories --> 
	<property name="report.dir"  		value="${basedir}/test-results" />
	<property name="junitreport.dir"  	value="${report.dir}/junitreport" />

	<target name="main" depends="init,runtests,junitreport" description="Main target for running the tests." />
	
	<target name="init" description="Init">
		<mkdir dir="${junitreport.dir}" />
	</target>
	
	<target name="runtests" description="Run our tests and produce awesome results">  

		<!-- Directory Runner -->
		<get dest="${report.dir}/alltests.xml" 
			 src="${url.runner}&amp;directory=${test.directory}&amp;reporter=${test.reporter}&amp;reportpath=${report.dir}" 
			 verbose="true"/>
		
		<!-- Bundles Runner
		<get dest="${report.dir}/test-results.xml" 
			 src="${url.runner}&amp;bundles=${test.bundles}&amp;reporter=${test.reporter}" 
			 verbose="true"/>
		 -->
		
	</target>  
	
	<target name="junitreport" description="Create a report for the rest result">  
		<!-- Create fancy junit reports -->
		<junitreport todir="${junitreport.dir}">  
			<fileset dir="${report.dir}">  
				<include name="TEST-*.xml"/>  
			</fileset>  
			<report format="frames" todir="${junitreport.dir}">
				<param name="TITLE" expression="My Awesome TestBox Results"/>
			</report>
		</junitreport>  
	</target>
  
</project>
